!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ds",[],t):"object"==typeof exports?exports.ds=t():e.ds=t()}(this,(function(){return function(e){function t(t){for(var o,r,l=t[0],a=t[1],c=t[2],d=0,p=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&p.push(s[r][0]),s[r]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);for(u&&u(t);p.length;)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,l=1;l<n.length;l++){var a=n[l];0!==s[a]&&(o=!1)}o&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},s={3:0},i=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var l=this.webpackJsonp_name_=this.webpackJsonp_name_||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=a;return i.push([32,0,7]),n()}({32:function(e,t,n){function o(){n(33)}var s=function(){return["filter"in Array.prototype?0:1,"findIndex"in Array.prototype?0:1,"values"in Object?0:1,"Promise"in self?0:1,"endsWith"in String.prototype?0:1,"includes"in String.prototype?0:1,"fetch"in self?0:1]}.call(window);if(-1===s.indexOf(1))o();else{var i=document.createElement("script");i.src="/polyfills."+s.join("")+".js",i.onload=o,i.onerror=function(e){console.error("Could not load the polyfills: "+e)},document.head.appendChild(i)}},33:function(e,t,n){"use strict";n.r(t);n(66);var o=n(9),s=n(15),i=n(19),r=n(20),l=n(21),a=n(22),c=n(2);n(34),n(5);o.a.autoReplaceSvg="nest",o.c.add(s.faPlusSquare,i.faPen,r.faSearch,l.faAngleRight,a.faTimes),o.b.watch(),window.jQuery=c,window.$=c;var u=n(36);n(39),n(40);var d=u.compile(n(41)),p=u.compile(n(42)),f=u.compile(n(43)),h=u.compile(n(44));c(document).ready((function(){var e=null;c("#search").on("hidden.bs.collapse",(function(e){c("#choose").toggleClass("d-none"),c("#search").toggleClass("d-none"),c("#searchinput").val("")})).on("shown.bs.collapse",(function(e){c("#choose").toggleClass("d-none"),c("#search").toggleClass("d-none"),c("#searchinput").focus()})),c("#ds-search-list").on("show.bs",(function(t){e=setTimeout((function(){c("#searching").show()}),500)})).on("hide.bs",(function(t){c("#searching").hide(),e&&clearTimeout(e)})),c("#add_button").on("click",(function(e){e.preventDefault(),c("#choose").toggleClass("d-none"),c("#search").toggleClass("d-none")})),c("#edit_button").on("click",(function(e){e.preventDefault(),c("#choosetools").toggleClass("d-none"),c("#done_button").toggleClass("d-none").toggleClass("display-block"),c("#savedchoices").removeClass("choose").addClass("edit"),c(".institution-text").addClass("item-fade"),c(".institution-icon").addClass("item-fade"),c(".institution-select").toggleClass("d-none"),c(".institution-remove").toggleClass("d-none")})),c("#done_button").on("click",(function(e){e.preventDefault(),c("#done_button").toggleClass("d-none").toggleClass("display-block"),c("#choosetools").toggleClass("d-none"),c("#savedchoices").removeClass("edit").addClass("choose"),c(".institution-text").removeClass("item-fade"),c(".institution-icon").removeClass("item-fade"),c(".institution-select").toggleClass("d-none"),c(".institution-remove").toggleClass("d-none")})),c("#dsclient").discovery_client({mdq:"https://md.seamlessaccess.org/entities/",persistence:"https://service.seamlessaccess.org/ps/",search:"https://md.seamlessaccess.org/entities/",context:"seamlessaccess.org",inputfieldselector:"#searchinput",render_search_result:function(t){return console.log("render_search_result"),e&&(clearTimeout(e),e=null),c("#searching").hide(),d.render(t)},render_saved_choice:function(e){return p.render(e)},too_many_results:function(t,n){e&&(clearTimeout(e),e=null),c("#searching").hide();var o=f.render({count:n});return c("body").on("click","#showall",(function(){console.log(t),t.showall()})),o},no_results:function(){return e&&(clearTimeout(e),e=null),c("#searching").hide(),h.render()},after:function(e,t){console.log("after - "+e),c("#searching").hide(),0==e?(c("#search").removeClass("d-none"),c("#choose").addClass("d-none"),c("#searchinput").focus()):(c("#choose").removeClass("d-none"),c("#search").addClass("d-none"))}}).discovery_client("sp").then((function(e){return c(".sp_title").text(e.title)}))}))},39:function(e,t){var n;(n=jQuery).fn.btsListFilter=function(e,t){"use strict";var o,s,i,r,l,a=this,c=n(this),u=n(e),d=c;return t=n.extend({delay:300,minLength:1,initial:!0,casesensitive:!1,eventKey:"keyup",resetOnBlur:!0,sourceData:null,sourceTmpl:'<a class="list-group-item" href="#"><span>{title}</span></a>',sourceNode:function(e){return function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,(function(e,n){return t[n]||""}))}(t.sourceTmpl,e)},emptyNode:function(e){return'<a class="list-group-item well" href="#"><span>No Results</span></a>'},cancelNode:function(){return'<span class="btn glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'},maxResults:-1,maxResultsNode:function(e){return'<span class="list-groiup-item well">Too many results - keep typing to refine search</span>'},sourceNodes:void 0,loadingClass:"bts-loading-list",itemClassTmp:"bts-dynamic-item",itemEl:".list-group-item",itemChild:null,itemFilter:function(e,o){o=o&&o.replace(new RegExp("[({[^.$*+?\\]})]","g"),"");var s=n(e).text(),i=t.initial?"^":"";return new RegExp(i+o,t.casesensitive?"":"i").test(s)},showEvent:"show.bs",hideEvent:"hide.bs"},t),a.reset=function(){u.val("").trigger(t.eventKey)},a.showall=function(){t.maxResults=-1,u.trigger(t.eventKey)},n.isFunction(t.cancelNode)&&(o=n(t.cancelNode.call(a)).hide(),u.after(o),u.parents(".form-group").addClass("has-feedback"),u.prev().is(".control-label")||o.css({top:0}),o.css({"pointer-events":"auto"}),o.on("click",a.reset)),u.on(t.eventKey,(i=function(e){var i=n(this).val();t.itemEl&&(d=c.find(t.itemEl)),t.itemChild&&(d=d.find(t.itemChild));var r=d.filter((function(){return t.itemFilter.call(a,this,i)})),l=d.not(r);t.itemChild&&(r=r.parents(t.itemEl),l=l.parents(t.itemEl).hide()),""!==i&&i.length>=t.minLength?(r.show(),l.hide(),o.show(),a.trigger(t.showEvent),"function"===n.type(t.sourceData)?(r.hide(),l.hide(),s&&(n.isFunction(s.abort)?s.abort():n.isFunction(s.stop)&&s.stop()),c.addClass(t.loadingClass),s=t.sourceData.call(a,i,(function(e){if(s=null,r.hide(),l.hide(),c.find("."+t.itemClassTmp).remove(),t.sourceNodes)t.sourceNodes.call(a,t,i,e,(function(e){n(e).addClass(t.itemClassTmp).appendTo(c)}));else if(e&&0!==e.length)if(t.maxResults<0||e.length<=t.maxResults)for(var o in e)n(t.sourceNode.call(a,e[o])).addClass(t.itemClassTmp).appendTo(c);else n(t.maxResultsNode(e)).addClass(t.itemClassTmp).appendTo(c);else n(t.emptyNode.call(a,i)).addClass(t.itemClassTmp).appendTo(c);c.removeClass(t.loadingClass)}))):(c.find("."+t.itemClassTmp).remove(),0===r.length&&n(t.emptyNode.call(a,i)).addClass(t.itemClassTmp).appendTo(c))):(r.show(),l.show(),o.hide(),a.trigger(t.hideEvent),c.find("."+t.itemClassTmp).remove())},r=(r=t.delay)||300,function(){var e=this,t=arguments;clearTimeout(l),l=setTimeout((function(){i.apply(e,Array.prototype.slice.call(t))}),r)})),t.resetOnBlur&&u.on("blur",(function(e){a.reset()})),c}},40:function(e,t,n){"use strict";n.r(t);var o=n(5);jQuery((function(e){e.widget("thiss.discovery_client",{options:{persistence:void 0,search:void 0,mdq:void 0,context:void 0,before:void 0,after:void 0,render:void 0,render_search_result:void 0,render_saved_choice:void 0,fallback_icon:void 0,input_field_selector:"input",search_result_selector:"#ds-search-list",saved_choices_selector:"#ds-saved-choices",entity_selector:".identityprovider",too_many_results:void 0,no_results:void 0},_create:function(){var t=this;e.isFunction(t.options.render)||(t.options.render=e.noop),e.isFunction(t.options.search)||(t.options.search_url=t.options.search,t.options.search=function(e,n){return Object(o.json_mdq_search)(e,t.options.search_url).then((function(e){return e.filter((function(e){return"true"!=e.hidden}))})).then(n)}),e.isFunction(t.options.render_search_result)||(t.options.render_search_result=t.options.render),e.isFunction(t.options.render_saved_choice)||(t.options.render_saved_choice=t.options.render),e.isFunction(t.options.fallback_icon)||(t.options.fallback_icon=e.noop),e.isFunction(t.options.after)||(t.options.after=e.noop),e.isFunction(t.options.before)||(t.options.before=function(e){return e}),t._update()},_setOption:function(e,t){this.options[e]=t,this._update()},sp:function(){var e=Object(o.parse_qs)(window.location.search.substr(1).split("&")).entityID;return e?this._ds.mdq(e).then((function(t){return t||Promise.resolve({entity_id:e,title:e})})):(console.log("Missing entityID parameter in discovery request"),{title:"Unknown"})},_after:function(t){var n=e(this.options.saved_choices_selector);if(this.options.search){var o=this,s=e(o.options.search_result_selector),i=0;e(o.options.input_field_selector).focus(),s.btsListFilter(o.options.input_field_selector,{resetOnBlur:!1,casesensitive:!1,maxResults:10,itemEl:o.options.entity_selector,getValue:function(e){var t=e.val(),n=t.indexOf("@");return n>-1?t.substring(n+1,t.length):t},sourceNodes:function(e,t,n,s){if(console.log(e),console.log(t),console.log(n),console.log(s),0!=n.length&&n)if(e.maxResults>0&&n.length>e.maxResults)s(o.options.too_many_results(this,n.length));else for(var r in n){var l=n[r];i+=1,l.counter=i,l.saved=!1,s(o.options.render_search_result(l))}else s(o.options.no_results(t))},sourceData:o.options.search,cancelNode:function(){console.log("cancel")}})}this.options.after(t,n)},_update:function(){var t=this;t._ds=new o.DiscoveryService(t.options.mdq,t.options.persistence,t.options.context),t._count=0;t.element;e("img.pyff-idp-icon").bind("error",(function(){e(this).unbind("error"),t.options.fallback_icon(this)})),e("body").on("mouseenter",t.options.entity_selector,(function(t){e(this).addClass("active")})),e("body").on("mouseleave",t.options.entity_selector,(function(t){e(this).removeClass("active")})),e("body").on("click",t.options.entity_selector,(function(n){var o=e(this).closest(t.options.entity_selector).attr("data-href");return console.log(o),t._ds.saml_discovery_response(o)})),e("body").on("keyup",t.options.entity_selector,(function(t){13===t.keyCode&&(t.preventDefault(),e(this).click())})),e(t.options.input_field_selector).closest("form").submit((function(e){e.preventDefault()})),e("body").on("click",".remove",(function(n){n.stopPropagation();var o=e(this).closest(t.options.entity_selector);t._count=o.siblings().length+1;var s=o.attr("data-href");console.log("removing "+s),console.log(o),s&&t._ds.remove(s).then((function(){o.remove()})).then((function(){t._count-=1,t._after(t._count)}))})),t._ds.with_items((function(n){console.log(n),n=t.options.before(n);var o=0,s=e(t.options.saved_choices_selector);return console.log(n),n&&n.length>0&&n.forEach((function(e){var n=e.entity;n.saved=!0;var i=t.options.render_saved_choice(n);s.prepend(i),o++})),t._after(o),n}))}})}))},41:function(e,t){e.exports='<a class="institution identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li><i class="arrow fa fa-angle-right"></i>\n        <div class="d-block institution-text">\n            <div class="text-truncate label primary">{{title}}</div>\n            <div class="text-truncate label-url secondary">{{domain}}</div>\n        </div>\n    </li>\n</a>'},42:function(e,t){e.exports='<a class="identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li class="institution clearfix">\n        <i class="institution-remove remove top-right fa fa-times d-none"></i>\n        {{#entity_icon}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon}}" />\n        </div>\n        {{/entity_icon}}\n        {{#entity_icon_url}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon_url.url}}" />\n        </div>\n        {{/entity_icon_url}}\n        {{^entity_icon_url}}\n        {{^entity_icon}}\n            <svg class="institution-icon logo"\n                 width="40"\n                 height="40">\n                <circle cx="20" cy="20" r="20" fill="#aeaeae" />\n                <text x="50%"\n                      y="50%"\n                      text-anchor="middle"\n                      fill="white"\n                      font-size="12px"\n                      font-family="Arial"\n                      dy=".3em">{{name_tag}}</text>\n            </svg>\n        {{/entity_icon}}\n        {{/entity_icon_url}}\n        <div class="institution-text">\n            <i class="institution-select arrow fa fa-angle-right"></i>\n            <div class="primary">{{title}}</div>\n            <span class="secondary">{{domain}}</span>\n        </div>\n    </li>\n</a>\n'},43:function(e,t){e.exports='<li class="type-ahead-alert">\n    <div role="alert">\n        <p><span class="bold">{{count}} Matches</span> keep typing to refine your search</p>\n        <p><a id="showall" href="#">(show me all matches anyway)</a></p>\n    </div>\n</li>'},44:function(e,t){e.exports='<li>\n    <div class="no-results-alert" role="alert">\n        <h3 class="bold">No matching institutions found</h3>\n        <ul>\n            <li>Try entering an institution name, abbreviation or your institution email</li>\n            <li>Try accessing through your library website</li>\n            <li>Contact your librarian</li>\n        </ul>\n    </div>\n</li>'},66:function(e,t){}})}));